#include <stdlib.h>
#include <stdio.h>
#include <string.h>

void main(){
    system("dpkg -p | tee file.txt");

    short s1 = 9;
    short s2 = 9;

    char verkage[256];
    char bufferin[256], bufferout[256];
    FILE* fptr;
    fptr = fopen("file.txt","r");
    FILE* wptr;
    wptr = fopen("output.txt","w");

    while(fgets(bufferin,sizeof(bufferin),fptr)){
        if(strstr(bufferin,"Package:") != NULL){
             strncpy(bufferout,bufferin+s1,sizeof(bufferin) -7);
            bufferout[sizeof(bufferin)-s1]='\0';
             fprintf(wptr, "%s", bufferout);

        }

        else if(strstr(bufferin,"Version:")!= NULL){
            strncpy(bufferout,bufferin+s2,sizeof(bufferin) -7);
            bufferout[sizeof(bufferin)-s2]='\0';
             fprintf(wptr, "%s", bufferout);
        }
        
    }
    fclose(wptr);
    fclose(fptr);
    fptr = fopen("output.txt","r");

    char http[256];
    int index = 0;

strcpy(http,"curl -X \'GET\' http://localhost:5000/api/search-vendor/ven");
    while(fgets(bufferin,sizeof(bufferin),fptr)){
	bufferin[strcspn(bufferin,"\n")]='\0';
	
	strcat(http,"/");
	strcat(http,bufferin);
        index++;
	if(index%2==0){
		strcat(http, " -H \'accept: application/json\' | tee -a response.txt");
		system(http);
	
	strcpy(http,"curl -X \'GET\' http://localhost:5000/api/search-vendor/ven");
	}
    }
	fclose(fptr);
}
