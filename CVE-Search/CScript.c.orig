#include <stdlib.h>
#include <stdio.h>
#include <string.h>
//#include <curl/curl.h>

void main(){
    system("dpkg -p | tee file.txt");

    short s1 = 9;
    short s2 = 9;

    char verkage[256];
    char bufferin[256], bufferout[256];
    FILE* fptr;
    fptr = fopen("file.txt","r");
    FILE* wptr;
    wptr = fopen("output.txt","w");

    while(fgets(bufferin,sizeof(bufferin),fptr)){
        if(strstr(bufferin,"Package:") != NULL){
             strncpy(bufferout,bufferin+s1,sizeof(bufferin) -7);
            bufferout[sizeof(bufferin)-s1]='\0';
             fprintf(wptr, "%s", bufferout);

        }

        else if(strstr(bufferin,"Version:")!= NULL){
            strncpy(bufferout,bufferin+s2,sizeof(bufferin) -7);
            bufferout[sizeof(bufferin)-s2]='\0';
             fprintf(wptr, "%s", bufferout);
        }
        
    }
    fclose(wptr);
    fclose(fptr);
//    wptr = fopen("response.txt","w");
    fptr = fopen("output.txt","r");

   // CURL *url;
 //  / CURLcode res;
    char http[256];
    int index = 0;

  // url = curl_easy_init();
strcpy(http,"curl -X \'GET\' http://localhost:5000/api/search-vendor/ven");
    while(fgets(bufferin,sizeof(bufferin),fptr)){
       // strcpy(http,"http://localhost:5000/api/search-vendor/ven/");
       /* for(int i = index; i < index+2; i++){
            strcat(http,"/");
		strcat(http,bufferin);
        
	}*/
	bufferin[strcspn(bufferin,"\n")]='\0';
	//strcat(http,bufferin);
	strcat(http,"/");
	strcat(http,bufferin);
//	printf("test");
        index++;
	if(index%2==0){
		strcat(http, " -H \'accept: application/json\' | tee -a response.txt");
		system(http);
	
	strcpy(http,"curl -X \'GET\' http://localhost:5000/api/search-vendor/ven");
	}//printf("%s\n",http);
       // url = curl_easy_init();
       /* if(url && (index%2)==0){
		strcat(http,"-H \'Content-Type: application-json\'");
            curl_easy_setopt(url,CURLOPT_URL, http);
	    curl_easy_setopt(url, CURLOPT_WRITEDATA,wptr);
            res = curl_easy_perform(url);
	    if(res!= CURLE_OK){
		   printf("FAILURE!!!%s\n",http);
	    }
	    strcpy(http,"http://localhost:5000/api/search-vendor/ven/");
	   // curl_easy_cleanup(url);
	   // sprintf(verkage,"%u\n",res);
	   // fprintf(wptr,"%s",verkage);
        }*/
        //fputs(res,wptr);
    }
	fclose(fptr);
}
